---
import DashboardLayout from '../../layouts/DashboardLayout.astro';
import StatCard from '../../components/dashboard/StatCard.astro';
import Button from '../../components/ui/Button.astro';
import ExpenseModal from '../../components/dashboard/ExpenseModal.jsx';
---
<DashboardLayout title="Ringkasan Shift">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div id="total-revenue-card" class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
      <p class="text-sm font-medium text-slate-500 mb-1">Total Pendapatan (Omzet)</p>
      <p class="text-2xl font-bold text-slate-900">Rp 0</p>
    </div>
    <div id="total-expenses-card" class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
      <p class="text-sm font-medium text-slate-500 mb-1">Total Pengeluaran</p>
      <p class="text-2xl font-bold text-slate-900">Rp 0</p>
    </div>
    <div id="net-income-card" class="bg-emerald-50 p-6 rounded-2xl shadow-sm border border-emerald-100">
      <p class="text-sm font-medium text-emerald-600 mb-1">Pendapatan Bersih</p>
      <p class="text-2xl font-bold text-emerald-800">Rp 0</p>
    </div>
  </div>

  <div class="bg-white rounded-2xl p-8 border border-slate-100 grid md:grid-cols-2 gap-8 items-center">
    <div>
      <h3 class="text-xl font-bold text-slate-900 mb-2">Aktivitas Shift</h3>
      <p class="text-slate-500 mb-6">Scan nota baru atau catat pengeluaran shift hari ini.</p>
      <div class="flex flex-col md:flex-row gap-4">
        <a href="/dashboard/scan" class="flex-1">
          <Button>ðŸ“¸ Scan Nota</Button>
        </a>
        <Button variant="outline" id="add-expense-btn">ðŸ’¸ Catat Pengeluaran</Button>
      </div>
    </div>
    <div class="bg-slate-50 rounded-xl p-6 border text-center">
      <p class="text-slate-500 text-sm">Transaksi Tercatat</p>
      <p class="text-5xl font-bold text-slate-900" id="transaction-count">0</p>
    </div>
  </div>
  
  <ExpenseModal client:load />
</DashboardLayout>

<script>
  import { api } from '../../services/api.js';
  import { dashboardData } from '../../stores/user.js';
  
  function formatCurrency(value) {
    return `Rp ${(value || 0).toLocaleString('id-ID')}`;
  }

  function updateUI(data) {
    document.querySelector('#total-revenue-card p:last-child').textContent = formatCurrency(data.totalRevenue);
    document.querySelector('#total-expenses-card p:last-child').textContent = formatCurrency(data.totalExpenses);
    document.querySelector('#net-income-card p:last-child').textContent = formatCurrency(data.netIncome);
    document.getElementById('transaction-count').textContent = data.transactionCount || 0;
  }

  document.addEventListener('astro:page-load', async () => {
    try {
      const data = await api.getDashboard();
      dashboardData.set(data);
    } catch (e) {
      console.error("Failed to fetch dashboard data");
    }
  });

  dashboardData.subscribe(data => {
    if (data) updateUI(data);
  });
</script>
