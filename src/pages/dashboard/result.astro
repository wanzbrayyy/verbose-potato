---
import DashboardLayout from '../../layouts/DashboardLayout.astro';
import Button from '../../components/ui/Button.astro';
---
<DashboardLayout title="Hasil Analisis AI">
  <div id="result-container" class="max-w-2xl mx-auto space-y-6">
    <!-- Content injected via JS -->
    <div class="bg-white p-6 rounded-2xl shadow-sm text-center">
      <p class="text-slate-500">Memuat hasil...</p>
    </div>
  </div>
</DashboardLayout>

<script>
  import { scanResult } from '../../stores/user.js';

  const container = document.getElementById('result-container');
  
  scanResult.subscribe(data => {
    if (!data) {
      window.location.href = '/dashboard/scan';
      return;
    }

    const itemsHtml = data.data.map(item => `
      <div class="flex justify-between items-center p-4 bg-slate-50 rounded-xl border border-slate-100 mb-3">
        <div class="flex items-center gap-4">
          <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center font-bold text-slate-700 shadow-sm">
            ${item.qty}x
          </div>
          <div>
            <h4 class="font-bold text-slate-900">${item.product}</h4>
            <p class="text-sm text-slate-500">@ Rp ${item.price / 1000}k</p>
          </div>
        </div>
        <div class="text-right">
          <p class="font-bold text-slate-900">Rp ${(item.qty * item.price).toLocaleString()}</p>
          <span class="text-xs font-bold px-2 py-1 rounded ${item.status === 'Lunas' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}">
            ${item.status.toUpperCase()}
          </span>
        </div>
      </div>
    `).join('');

    container.innerHTML = `
      <div class="bg-slate-900 text-white p-6 rounded-2xl shadow-xl flex justify-between items-center">
        <div>
          <p class="text-slate-400 text-sm">Total Transaksi</p>
          <p class="text-3xl font-bold">Rp ${data.total.toLocaleString()}</p>
        </div>
        <div class="text-right">
          <span class="bg-white/10 px-3 py-1 rounded-full text-sm">${data.data.length} Item</span>
        </div>
      </div>

      <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
        <h3 class="font-bold text-lg mb-4 text-slate-800">Rincian Item</h3>
        ${itemsHtml}
      </div>

      <div class="flex gap-4">
        <button onclick="window.location.href='/dashboard/scan'" class="flex-1 py-3 px-4 rounded-xl font-bold border-2 border-slate-200 text-slate-600 hover:bg-slate-50">
          Scan Lagi
        </button>
        <button onclick="window.location.href='/dashboard'" class="flex-1 py-3 px-4 rounded-xl font-bold bg-slate-900 text-white hover:bg-slate-800 shadow-lg">
          Selesai
        </button>
      </div>
    `;
  });
</script>
