---
import AuthLayout from '../../layouts/AuthLayout.astro';
import Input from '../../components/ui/Input.astro';
import Button from '../../components/ui/Button.astro';
---
<AuthLayout title="Daftar - Warkop Arum">
  <form id="register-form">
    <Input label="Nama Toko" name="nama" required />
    <Input label="Email" name="email" type="email" required />
    <Input label="Password" name="password" type="password" required />
    <Button type="submit" class="mt-4">DAFTAR SEKARANG</Button>
  </form>
  <p class="text-center mt-6 text-slate-500">
    Sudah punya akun? <a href="/auth/login" class="text-slate-900 font-bold hover:underline">Login</a>
  </p>
</AuthLayout>

<script>
  import { api } from '../../services/api';

  const form = document.getElementById('register-form');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const btn = form.querySelector('button');
    
    try {
      btn.textContent = 'Memproses...';
      const res = await api.register(
        formData.get('nama'),
        formData.get('email'),
        formData.get('password')
      );
      
      if (res.success) {
        alert('Berhasil! Silakan Login');
        window.location.href = '/auth/login';
      } else {
        alert(res.error || 'Gagal Daftar');
      }
    } catch (err) {
      alert('Error koneksi');
    } finally {
      btn.textContent = 'DAFTAR SEKARANG';
    }
  });
</script>
