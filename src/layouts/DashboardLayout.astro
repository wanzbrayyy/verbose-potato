---
import BaseLayout from './BaseLayout.astro';
import Sidebar from '../components/dashboard/Sidebar.astro';
const { title } = Astro.props;
---
<BaseLayout title={title}>
  <div class="flex h-screen overflow-hidden">
    <Sidebar />
    <main class="flex-1 overflow-y-auto bg-slate-50 p-4 md:p-8">
      <header class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold text-slate-800">{title}</h2>
        <div class="flex items-center gap-4">
          <span class="text-sm font-medium text-slate-600" id="user-name">Admin</span>
          <button id="logout-btn" class="text-sm text-red-600 hover:text-red-700 font-medium">Logout</button>
        </div>
      </header>
      <slot />
    </main>
  </div>
  <script>
    import { userStore, logout } from '../stores/user.js';
    
    userStore.subscribe(u => {
      if (!u && window.location.pathname.startsWith('/dashboard')) {
        window.location.href = '/auth/login';
      } else if (u) {
        const el = document.getElementById('user-name');
        if(el) el.textContent = u.nama;
      }
    });

    document.getElementById('logout-btn')?.addEventListener('click', logout);
  </script>
</BaseLayout>
